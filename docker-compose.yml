#version: '3.8'
#
#services:
#    laravel:
#        image: php:8.3-cli
#        container_name: laravel-app
#        working_dir: /var/www/html
#        volumes:
#            - .:/var/www/html
#        ports:
#            - "8000:8000"
#        command: bash -c "apt-get update \
#            && apt-get install -y unzip libzip-dev \
#            && docker-php-ext-install pdo pdo_mysql \
#            && php artisan serve --host=0.0.0.0 --port=8000"
#        env_file:
#            - .env   # <-- load variables from your local .env file
#        extra_hosts:
#            - "host.docker.internal:host-gateway"
version: '3.8'

services:
    app:
        build:
            context: .
            dockerfile: Dockerfile   # <-- use the production-ready Dockerfile we wrote earlier
        container_name: laravel-app
        volumes:
            - .:/var/www/html
        ports:
            - "8000:80"   # maps containerâ€™s Apache (80) to localhost:8000
        env_file:
            - .env
        extra_hosts:
            - "host.docker.internal:host-gateway"
        depends_on:
            - mysql
            - redis

    mysql:
        image: mysql:8.0
        container_name: laravel-mysql
        restart: unless-stopped
        environment:
            MYSQL_ROOT_PASSWORD: root
            MYSQL_DATABASE: laravel
            MYSQL_USER: laravel
            MYSQL_PASSWORD: secret
        ports:
            - "3306:3306"
        volumes:
            - db_data:/var/lib/mysql

    redis:
        image: redis:7
        container_name: laravel-redis
        ports:
            - "6379:6379"

volumes:
    db_data:
